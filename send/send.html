<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHU Config App</title>
    <!-- Bootstrap CSS -->
    <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="apple-icon-180.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="stylesheet" href="./css/bs513.css">
    
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="./css/send.css">
    <script src="./js/index.js"></script>
    <script src="./js/popup.js"></script>
    <link rel="manifest" href="./sendmanifest.json">
</head>
<script>
  // Add a global error event listener early on in the page load, to help ensure that browsers
  // which don't support specific functionality still end up displaying a meaningful message.
  window.addEventListener('error', function(error) {
    if (ChromeSamples && ChromeSamples.setStatus) {
      console.error(error);
      ChromeSamples.setStatus(error.message + ' (Your browser may not support this feature.)');
      error.preventDefault();
    }
  });
</script>

<script>
  if('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', function() {
    const searchParams = new URL(location).searchParams;
    const inputs = Array.from(document.querySelectorAll('input[id]'));

    inputs.forEach(input => {
      if (searchParams.has(input.id)) {
        if (input.type == 'checkbox') {
          input.checked = searchParams.get(input.id);
        } else {
          input.value = searchParams.get(input.id);
          input.blur();
        }
      }
      if (input.type == 'checkbox') {
        input.addEventListener('change', function(event) {
          const newSearchParams = new URL(location).searchParams;
          if (event.target.checked) {
            newSearchParams.set(input.id, event.target.checked);
          } else {
            newSearchParams.delete(input.id);
          }
          history.replaceState({}, '', Array.from(newSearchParams).length ?
              location.pathname + '?' + newSearchParams : location.pathname);
        });
      } else {
        input.addEventListener('input', function(event) {
          const newSearchParams = new URL(location).searchParams;
          if (event.target.value) {
            newSearchParams.set(input.id, event.target.value);
          } else {
            newSearchParams.delete(input.id);
          }
          history.replaceState({}, '', Array.from(newSearchParams).length ?
              location.pathname + '?' + newSearchParams : location.pathname);
        });
      }
    });
  });
</script>
<script>
  var ChromeSamples = {
    log: function() {
      var line = Array.prototype.slice.call(arguments).map(function(argument) {
        return typeof argument === 'string' ? argument : JSON.stringify(argument);
      }).join(' ');

      document.querySelector('#log').textContent += line + '\n';
    },

    clearLog: function() {
      document.querySelector('#log').textContent = '';
    },

    setStatus: function(status) {
      document.querySelector('#status').textContent = status;
    },

    setContent: function(newContent) {
      var content = document.querySelector('#content');
      while(content.hasChildNodes()) {
        content.removeChild(content.lastChild);
      }
      content.appendChild(newContent);
    }
  };
</script>


<div class="toolbar border-bottom p-2 shadow-sm" style="background-color: aqua; ">

  <img src="./images/icon.png" style="padding-left: 1em;padding-right: 1em; height: 32px; width: 65px;"><div id="device-name" class="name"> AHU Config App</div>

  <div class="buttons">

      <button id="scan" type="button" aria-label="Connect">
          <i class="material-icons">bluetooth_connected</i>
      </button>

      <button id="disconnect" type="button" aria-label="Disconnect">
          <i class="material-icons">bluetooth_disabled</i>
      </button>
      <!-- <button id="reconnect" type="button" aria-label="Reconnect">
        <i class="material-icons">bluetooth_connect</i>
    </button> -->

  </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
<br>


  

<body style="background-color: rgb(155, 240, 107);">
    <div class="container">
      <p class="marquee"><div id="output" class="output">
        <div id="content"></div>
        <div id="status"></div>
        <pre id="log"></pre>
        </div></p>
    <!-- <div class="alert alert-warning alert-dismissible fade show" style="background-color: rgb(155, 240, 107); outline: rgb(155, 240, 107);" role="alert">
      <div id="terminal" class="terminal"></div>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>  -->
    <div class="col">
              <div class="card" style="background-color: gold;">
                
                
                <div class="card-body">
                  <h5 class="card-title" >Set Temperature</h5>
                  <div class="row row-cols-2">
                  <div class="col">
                    
                    
                  
                  
                  <span class="d-flex"><button type="button" class="btn btn-info btn-sm"><label for="temp">Temp</label></button>
                  <input  class="form-control me-2" style="max-width: 20em; padding-left: 1em; padding-right: 1em;" id="temp" type="number" step="0.5" value="0.0"  onchange="tempclicked(value)">
                 </span>
                 </div>
                 <div class="col">
                  <span class="d-flex"><button type="button" class="btn btn-info btn-sm"><label for="band">Band</label></button>
                    <input  class="form-control me-2" style="max-width: 20em; padding-left: 1em; padding-right: 1em;" id="band" type="number" step="1" value="0.0" onchange="bandclicked(value)">
                   </span>

                 </div>
                  
                </div>
              </div>
            </div>
            
            <div class="card" style="background-color: gold;">
                
                
              <div class="card-body">
                
                <div class="row row-cols-2">
                <div class="col">
                
                
                <span class="d-flex"><button type="button" class="btn btn-info btn-sm" style="min-width: 3em;"><label for="delay">Delay</label></button>
                <input  class="form-control me-2" style="max-width: 20em; padding-left: 1em; padding-right: 1em;" id="delay" type="number" step="1" max="60" min="0" value="0" onchange="delayclicked(value)">
               </span>
               </div>
               <div class="col">
                <span class="d-flex"><button type="button" class="btn btn-info btn-sm"><label for="currentDateTime">Time</label></button>
                  <input  class="form-control me-2" style="max-width: 20em; padding-left: 1em; padding-right: 1em;" id="currentDateTime" type="text" >
                 </span>

               </div>
                
              </div>
            </div>
          </div>
          
            <select class="form-select" aria-label="Default select example" style="background-color: rgb(144, 247, 178);">
              <option selected>Select</option>
              <option value="relay" style="max-width: fit-content">Relay</option>
              <option value="vfd">VFD</option>
              
            </select>
          
            <div class="col">
              <div class="card" style="background-color: gold;">
                <div class="card-body">
                  <h5 class="card-title">Schedule</h5>
                  <div class="row row-cols-2">
                    <div class="col">
                <input
                  class="form-control me-2"
                  type="time"
                  value="00:00:00"
                  id="ontime"
                  style="
                    min-width: 3em;
                    max-width: 20em;
                    text-align: end;
                    align-self: center;
                    background-color: rgb(255, 255, 255);
                  "
                />
                </div>
                <div class="col">
                
                <input
                  class="form-control me-2"
                  id="offtime"
                  
                  type="time"
                  value="00:00:00"
                  style="
                    min-width: 3em;
                    max-width: 20em;
                    text-align: end;
                    align-self: center;
                    background-color: rgb(255, 255, 255);
                  "
                />
                </div>
                
                  
                </div>
              </div>
            </div>
            </div>
            
            <div class="d-flex flex-column flex-md-row align-items-centre  p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm" >
        
        
            <div class="row row-cols-2">
              <div class="col">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
                  <label class="form-check-label" for="flexSwitchCheckDefault">Manual_ON/OFF</label>
                </div>
              
              </div>
              <div class="col">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
                  <label class="form-check-label" for="flexSwitchCheckDefault">Auto ON/OFF</label>
                </div>
                
              </div>
              
              </div>
       
               
           
           </div>
           <form id="send-form" class="send-form" style="background-color: white; position: relative;">
                
            <input id="sendstr" type="text" onfocus="sendstring()"  placeholder="temp-band-delay-crttime-ontime-offtime" >

            <button type="submit" aria-label="Send">
                <i class="material-icons">send</i>
            </button>

        </form>
          
          </div>
    
</body>
</html>

  
  <script>
    window.addEventListener("load", () => {
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/electrofield/send/sendservice-worker.js");
      }
    });
    </script>



<script>
  var today = new Date();
var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
var dateTime = date+' '+time;
  document.getElementById("currentDateTime").value = dateTime;

  
  


</script>

<script>
  if (/Chrome\/(\d+\.\d+.\d+.\d+)/.test(navigator.userAgent)){
    // Let's log a warning if the sample is not supposed to execute on this
    // version of Chrome.
    if (55 > parseInt(RegExp.$1)) {
      ChromeSamples.setStatus('Warning! Keep in mind this sample has been tested with Chrome ' + 55 + '.');
    }
  }
</script>

<script>var bluetoothDevice;

  async function onScanButtonClick() {
      acceptAllDevices: true
  //   let options = {filters: []};
  
  //   let filterService = document.querySelector('#service').value;
  //   if (filterService.startsWith('0x')) {
  //     filterService = parseInt(filterService);
  //   }
  //   if (filterService) {
  //     options.filters.push({services: [filterService]});
  //   }
  
  //   let filterName = document.querySelector('#name').value;
  //   if (filterName) {
  //     options.filters.push({name: filterName});
  //   }
  
  //   let filterNamePrefix = document.querySelector('#namePrefix').value;
  //   if (filterNamePrefix) {
  //     options.filters.push({namePrefix: filterNamePrefix});
  //   }
  
    bluetoothDevice = null;
    try {
      log('Requesting Bluetooth Device...');
      bluetoothDevice = await navigator.bluetooth.requestDevice({acceptAllDevices: true});
      bluetoothDevice.addEventListener('gattserverdisconnected', onDisconnected);
      connect();
    } catch(error) {
      log('Argh! ' + error);
    }
  }
//////////////////////////////////////////////////////////
  function senddata()
  {
  var data= document.getElementById('sendstr').value;  
  {
  bluetoothDevice.send(data).then(() => movetoken()).catch((error) => log('Argh!'+error));
  };
  }
  ////////////////////////////////////////
  
  async function connect() {
    log('Connecting to Bluetooth Device...');
    await bluetoothDevice.gatt.connect();
    log('> Bluetooth Device connected');
  }
  
  function onDisconnectButtonClick() {
    if (!bluetoothDevice) {
      return;
    }
    log('Disconnecting from Bluetooth Device...');
    if (bluetoothDevice.gatt.connected) {
      bluetoothDevice.gatt.disconnect();
    } else {
      log('> Bluetooth Device is already disconnected');
    }
  }
  
  function onDisconnected(event) {
    // Object event.target is Bluetooth Device getting disconnected.
    log('> Bluetooth Device disconnected');
  }
  
  function onReconnectButtonClick() {
    if (!bluetoothDevice) {
      return;
    }
    if (bluetoothDevice.gatt.connected) {
      log('> Bluetooth Device is already connected');
      return;
    }
    try {
      connect();
    } catch(error) {
      log('Argh! ' + error);
    }
  }
  </script>
      
    
  
    
      
    
  
  
  
  <script>
    document.querySelector('#scan').addEventListener('click', function(event) {
      event.stopPropagation();
      event.preventDefault();
  
      if (isWebBluetoothEnabled()) {
        ChromeSamples.clearLog();
        onScanButtonClick();
      }
    });
    document.querySelector('#disconnect').addEventListener('click', function(event) {
      event.stopPropagation();
      event.preventDefault();
  
      if (isWebBluetoothEnabled()) {
        onDisconnectButtonClick();
      }
    });
    // document.querySelector('#reconnect').addEventListener('click', function(event) {
    //   event.stopPropagation();
    //   event.preventDefault();
  
    //   if (isWebBluetoothEnabled()) {
    //     onReconnectButtonClick();
    //   }
    // });
  </script>
  
  <script>
    log = ChromeSamples.log;
  
    function isWebBluetoothEnabled() {
      if (navigator.bluetooth) {
        return true;
      } else {
        ChromeSamples.setStatus('Web Bluetooth API is not available.\n' +
            'Please make sure the "Experimental Web Platform features" flag is enabled.');
        return false;
      }
    }
  </script>





  
  
  